#!/bin/sh
#
# mmd2xslt --- MultiMarkdown convenience script
#	<http://fletcherpenney.net/multimarkdown/>
#	Copyright (c) 2010-2011 Fletcher T. Penney
#
# Pass arguments on to the binary to convert text to LaTeX
#	using XSLT files after first converting to XHTML
#
#	This replicates the approach used in MMD 2.0
#

# Be sure to include multimarkdown in our PATH
export PATH="/usr/local/bin:$PATH"


if [ $# = 0 ]
then
	# No arguments, so use stdin/stdout
	
	# Need a temporary file
	file_name=`mktemp mmdtempXXXX.txt`
	
	cat > $file_name
	
	# Determine which stylesheet to use
	mode=`multimarkdown -e latexmode "$file_name"`

	# Locate XSLT directory
	xslt_path=`dirname "$0"`

	if [ "$mode" = "memoir" ]
	then
		# Use memoir
		multimarkdown "$file_name" | xsltproc -nonet -novalid $xslt_path/../XSLT/memoir.xslt -
		shift
	else
		if [ "$mode" = "beamer" ]
		then
			# Use memoir
			multimarkdown "$file_name" | xsltproc -nonet -novalid $xslt_path/../XSLT/beamer.xslt -
			shift
		else

		# Use default latex
		multimarkdown "$file_name" | xsltproc -nonet -novalid $xslt_path/../XSLT/xhtml2latex.xslt -
		shift
		fi
	fi

	rm $file_name
else
until [ "$*" = "" ]
do
	# process each argument separately
	file_name=`echo $1|cut -d. -f1 `
	
	# Determine which stylesheet to use
	mode=`multimarkdown -e latexmode "$1"`
	
	# Locate XSLT directory
	xslt_path=`dirname "$0"`
	
	if [ "$mode" = "memoir" ]
	then
		# Use memoir
		multimarkdown "$1" | xsltproc -nonet -novalid $xslt_path/../XSLT/memoir.xslt -  > "$file_name.tex"
		shift
	else if [ "$mode" = "beamer" ]
	then
		# Use memoir
		multimarkdown "$1" | xsltproc -nonet -novalid $xslt_path/../XSLT/beamer.xslt -  > "$file_name.tex"
		shift
	else
		# Use default latex
		multimarkdown "$1" | xsltproc -nonet -novalid $xslt_path/../XSLT/xhtml2latex.xslt -  > "$file_name.tex"
		shift
		fi
	fi
done
fi
